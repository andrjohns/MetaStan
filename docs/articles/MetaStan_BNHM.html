<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Conducting meta-analysis using MetaStan • MetaStan</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Conducting meta-analysis using MetaStan">
<meta property="og:description" content="MetaStan">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MetaStan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/MetaStan_BNHM.html">Conducting meta-analysis using MetaStan</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/gunhanb/MetaStan/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MetaStan_BNHM_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Conducting meta-analysis using MetaStan</h1>
                        <h4 class="author">Burak Kürsad Günhan</h4>
            
            <h4 class="date">2021-02-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gunhanb/MetaStan/blob/master/vignettes/MetaStan_BNHM.Rmd"><code>vignettes/MetaStan_BNHM.Rmd</code></a></small>
      <div class="hidden name"><code>MetaStan_BNHM.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>To fit meta-analysis models using frequentist methods, there are many R packages available including <code>metafor</code>. On the other hand, Bayesian estimation methods such as Markov chain Monte Carlo (MCMC) are very attractive for meta-analysis, especially because they can be used to fit more complicated models. These include binomial-normal hierarchical models and beta-binomial models which are based on the exact distributional assumptions unlike (commonly used) normal-normal hierarchical model. Another advantage of Bayesian methods to be able to use informative prior distributions for example to regularize heterogeneity estimates in case of low number of studies. Thus, we developed <code>MetaStan</code> which uses <strong>Stan</strong> (a modern MCMC engine) to fit several pairwise meta-analysis models including binomial-normal hierarchical model and beta-binomial model. This package is also the accompanying package for Günhan, Röver, and Friede (2020).</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>The development version of <code>MetaStan</code> is available on Github (<a href="https://github.com/gunhanb/MetaStan">https://github.com/gunhanb/MetaStan</a>) and can be installed using <code>devtools</code> package as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">:::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"gunhanb/MetaStan"</span><span class="op">)</span></code></pre></div>
<p>The BCG trials example is available in the package, and it can be loaded as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/gunhanb/MetaStan">"MetaStan"</a></span><span class="op">)</span>
<span class="co"># Loading required package: Rcpp</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"dat.Berkey1995"</span>, package <span class="op">=</span> <span class="st">"MetaStan"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dat.Berkey1995</span><span class="op">)</span>
<span class="co">#   Trial  rt    nt  rc    nc Latitude                 publication</span>
<span class="co"># 1     1   4   123  11   139       44              Aronson (1948)</span>
<span class="co"># 2     2   6   306  29   303       55     Ferguson &amp; Simes (1949)</span>
<span class="co"># 3     3   3   231  11   220       42      Rosenthal et al (1960)</span>
<span class="co"># 4     4  62 13598 248 12867       52    Hart &amp; Sutherland (1977)</span>
<span class="co"># 5     5  33  5069  47  5808       13 Frimodt-Moller et al (1973)</span>
<span class="co"># 6     6 180  1541 372  1451       44      Stein &amp; Aronson (1953)</span></code></pre></div>
<p>Additional information can be obtained by typing <code><a href="../reference/dat.Berkey1995.html">?dat.Berkey1995</a></code> (for any dataset and function in the package).</p>
<p>We can visualize individual log odds ratio estimates plot using <code>ggplot2</code> as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="co"># Calculating log odds ratios and variances from data</span>
<span class="va">logodds</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">stdes</span>   <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">r_ind</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">rt</span>, <span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">nt</span>, 
                 <span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">rc</span>, <span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">nc</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">logodds</span><span class="op">)</span>
<span class="va">se_ind</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">rt</span>, <span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">nt</span>, 
                 <span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">rc</span>, <span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">nc</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">stdes</span><span class="op">)</span>
<span class="va">lower95_ind</span> <span class="op">&lt;-</span> <span class="va">r_ind</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">.025</span><span class="op">)</span> <span class="op">*</span> <span class="va">se_ind</span>
<span class="va">upper95_ind</span> <span class="op">&lt;-</span> <span class="va">r_ind</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">.975</span><span class="op">)</span> <span class="op">*</span> <span class="va">se_ind</span>
<span class="co"># Comparison of the results</span>
<span class="va">trials</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span> ,<span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"7"</span>, <span class="st">"8"</span>, <span class="st">"9"</span>, <span class="st">"10"</span>, <span class="st">"11"</span>, <span class="st">"12"</span>, <span class="st">"13"</span><span class="op">)</span>
<span class="va">trials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span><span class="op">(</span><span class="va">trials</span>, levels <span class="op">=</span> <span class="va">trials</span><span class="op">)</span>

<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">trials</span>,
                y <span class="op">=</span> <span class="va">r_ind</span>,
                ylo <span class="op">=</span> <span class="va">lower95_ind</span>,
                yhi <span class="op">=</span> <span class="va">upper95_ind</span><span class="op">)</span>
<span class="va">forest.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, ymin <span class="op">=</span> <span class="va">ylo</span>, ymax <span class="op">=</span> <span class="va">yhi</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_pointrange</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Studies"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Forest Plot (BCG vaccines)"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">forest.plot</span><span class="op">)</span></code></pre></div>
<p><img src="MetaStan_BNHM_files/figure-html/forestplot-1.png" width="700"></p>
</div>
<div id="fitting-a-binomial-normal-hierarchical-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-a-binomial-normal-hierarchical-model" class="anchor"></a>Fitting a binomial-normal hierarchical model</h2>
<p><code>metastan</code> is the main fitting function of this package. The main computations are executed via the <code>rstan</code> package’s <code>sampling</code> function. We can fit the binomial-normal hierarchical model (Günhan, Röver, and Friede, 2020) using a weakly informative prior for treatment effect as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">'dat.Berkey1995'</span>, package <span class="op">=</span> <span class="st">"MetaStan"</span><span class="op">)</span>
 <span class="co">## Fitting a Binomial-Normal Hierarchical model using WIP priors</span>
 <span class="va">dat_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_data_arm.html">convert_data_arm</a></span><span class="op">(</span><span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">nt</span>, <span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">nc</span>,
                             <span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">rt</span>, <span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">rc</span>,
                             <span class="va">dat.Berkey1995</span><span class="op">$</span><span class="va">publication</span><span class="op">)</span>

 <span class="va">meta.BCG.stan</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/meta_stan.html">meta_stan</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat_long</span>,
                            family <span class="op">=</span> <span class="st">"binomial"</span>,
                            mu_prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>,
                            theta_prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,
                            tau_prior <span class="op">=</span> <span class="fl">0.5</span>,
                            tau_prior_dist <span class="op">=</span> <span class="st">"half-normal"</span><span class="op">)</span></code></pre></div>
<p>Convergence diagnostics, very conveniently, obtained using <code>shinystan</code> package as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"shinystan"</span><span class="op">)</span>
<span class="co">## Firstly convert "stan" object to a "shinystan" object</span>
<span class="va">bnhm1.BCG.shinystan</span> <span class="op">=</span> <span class="fu">as.shinystan</span><span class="op">(</span><span class="va">meta.BCG.stan</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span>
<span class="fu">launch_shinystan</span><span class="op">(</span><span class="va">meta.BCG.stan</span><span class="op">)</span></code></pre></div>
<p>A simple summary of the fitted model is given by <code>print</code> option:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">meta.BCG.stan</span><span class="op">)</span>
<span class="co"># Meta-analysis using MetaStan </span>
<span class="co"># </span>
<span class="co"># Maximum Rhat: 1 </span>
<span class="co"># Minimum Effective Sample Size: 1000 </span>
<span class="co"># </span>
<span class="co"># mu prior: Normal(0,10)</span>
<span class="co"># theta prior: Normal(0,100)</span>
<span class="co"># tau prior:half-normal(0.5)</span>
<span class="co"># </span>
<span class="co"># Treatment effect (theta) estimates</span>
<span class="co">#  mean  2.5%   50% 97.5% </span>
<span class="co"># -0.76 -1.14 -0.76 -0.37 </span>
<span class="co"># </span>
<span class="co"># Heterogeneity stdev (tau)</span>
<span class="co">#  mean  2.5%   50% 97.5% </span>
<span class="co">#  0.60  0.36  0.58  0.94</span></code></pre></div>
<p>Note that this model corresponds to Model 4 in Jackson et al (2018).</p>
<p>Please see Günhan, Röver, and Friede (2020) and Jackson et al (2018) for complete model descriptions.</p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Günhan, BK, Röver, C, and Friede, T (2020). “Random-effects meta-analysis of few studies involving rare events”. In: Research Synthesis Methods 11.1, pp. 74-90. DOI: 10.1002/jrsm.1370.</p>
<p>Jackson, D et al. (2018). “A comparison of seven random-effects models for meta-analyses that estimate the summary odds ratio”. In: Statistics in Medicine 37.7, pp. 1059-1085. DOI: 10.1002/sim.7588.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Burak Kuersad Guenhan, Christian Roever.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
